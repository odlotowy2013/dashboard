<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>BloxMart Dashboard</title>
<link rel="stylesheet" href="/style.css">
</head>
<body>
<div class="container">
<h1>BloxMart Dashboard</h1>
<a href="/logout" class="logout">Logout</a>

<h2>Add New Session</h2>
<form method="POST" action="/add" onsubmit="return validateAddForm(this);">
  <input type="text" name="id" placeholder="Session ID" required>
  <input type="text" name="type" placeholder="Session Type" required>
  <input type="text" name="host" placeholder="Host" required>
  <input type="text" name="cohosts" placeholder="Co-Hosts (comma separated)">
  <select name="status">
    <option value="Pending">Pending</option>
    <option value="In-progress">In-progress</option>
    <option value="Completed">Completed</option>
    <option value="Cancelled">Cancelled</option>
  </select>
  <button type="submit">Add Session</button>
</form>

<hr>

<table>
<thead>
<tr>
  <th>ID</th>
  <th>Type</th>
  <th>Host</th>
  <th>Co-Host</th>
  <th>Status</th>
  <th>Actions</th>
</tr>
</thead>
<tbody>
<% sessions.forEach(session => { %>
<tr>
  <td><%= session.id %></td>
  <td><%= session.type %></td>
  <td>
    <form method="POST" action="/update/<%= session.id %>" onsubmit="return validateForm(this);">
      <input type="text" name="host" value="<%= session.host %>">
  </td>
  <td>
      <input type="text" name="cohosts" value="<%= session.cohosts.join(', ') %>">
  </td>
  <td>
      <select name="status">
        <option value="Pending" <%= session.status === "Pending" ? "selected" : "" %>>Pending</option>
        <option value="In-progress" <%= session.status === "In-progress" ? "selected" : "" %>>In-progress</option>
        <option value="Completed" <%= session.status === "Completed" ? "selected" : "" %>>Completed</option>
        <option value="Cancelled" <%= session.status === "Cancelled" ? "selected" : "" %>>Cancelled</option>
      </select>
  </td>
  <td>
      <button type="submit">Save</button>
    </form>
    <form method="POST" action="/delete/<%= session.id %>" style="margin-top:5px;">
      <button type="submit" class="delete-btn">Delete</button>
    </form>
  </td>
</tr>
<% }) %>
</tbody>
</table>
</div>

<script>
function validateAddForm(form) {
  const host = form.querySelector('input[name="host"]').value.trim();
  const cohosts = form.querySelector('input[name="cohosts"]').value.split(',').map(x => x.trim()).filter(Boolean);
  if (!host && cohosts.length === 0) {
    alert("❌ You cannot add a session without a host or a Co-Host.");
    return false;
  }
  return true;
}

function validateForm(form) {
  const host = form.querySelector('input[name="host"]').value.trim();
  const cohosts = form.querySelector('input[name="cohosts"]').value.split(',').map(x => x.trim()).filter(Boolean);
  if (!host && cohosts.length === 0) {
    alert("❌ You cannot remove the host without a Co-Host.");
    return false;
  }
  return true;
}
</script>
</body>
</html>
